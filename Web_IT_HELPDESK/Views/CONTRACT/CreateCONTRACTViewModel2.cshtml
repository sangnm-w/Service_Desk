@model Web_IT_HELPDESK.Models.ContractViewModel

@{
    ViewBag.Title = "CreateCONTRACTViewModel2";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>


<div class="col-md-12 panel-info">
    <div class="content-box-header panel-heading">
        <div class="panel-title ">Add New Contract</div>

        <div class="panel-options">
            <a href="#" data-rel="collapse"><i class="glyphicon glyphicon-refresh"></i></a>
            <a href="#" data-rel="reload"><i class="glyphicon glyphicon-cog"></i></a>
        </div>
    </div>
    <div class="content-box-large box-with-header">
        @using (Html.BeginForm("CreateCONTRACTViewModel2", "CONTRACT", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-horizontal">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                <div class="row">
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.VENDOR, "Vendor", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.VENDOR, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.VENDOR, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.CONTRACT_TYPE_ID, "Contract Type", htmlAttributes: new { @class = "control-label" })
                        @Html.DropDownList("CONTRACT_TYPE_ID")
                        @Html.ValidationMessageFor(model => model.CONTRACT.CONTRACT_TYPE_ID, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.PERIODID, "Period", htmlAttributes: new { @class = "control-label" })
                        @Html.DropDownList("PERIODID")
                        @Html.ValidationMessageFor(model => model.CONTRACT.PERIODID, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.MONTHS, "Months", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.MONTHS, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.MONTHS, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.ADREES, "Address", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.ADREES, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.ADREES, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.PHONE, "Phone", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.PHONE, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.PHONE, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.REPRESENTATION, "Representation", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.REPRESENTATION, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.REPRESENTATION, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.DATE, "Date", htmlAttributes: new { @class = "control-label" })
                        <div class="input-group date" id="contractDate">
                            @Html.Editor("Date", new { htmlAttributes = new { @class = "form-control", autocomplete = "off" } })
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                        @Html.HiddenFor(model => model.CONTRACT.DATE, new { @id = "contractDate_val", @Value = "" })
                        @Html.ValidationMessageFor(model => model.CONTRACT.DATE, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.DATE_CREATE, "Date Create", htmlAttributes: new { @class = "control-label" })
                        <div class="input-group date" id="dateCreate">
                            @Html.Editor("Date Create", new { htmlAttributes = new { @class = "form-control", autocomplete = "off", @disabled = "disabled" } })
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                        @Html.HiddenFor(model => model.CONTRACT.DATE_CREATE, new { @id = "dateCreate_val", @Value = "" })
                        @Html.ValidationMessageFor(model => model.CONTRACT.DATE_CREATE, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.CONTRACTNAME, "Contract Name", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.CONTRACTNAME, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.CONTRACTNAME, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.DEPARTMENTID, "Department", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.DEPARTMENTID, new { htmlAttributes = new { @class = "form-control", @Value = (string)ViewBag.curr_deptId } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.DEPARTMENTID, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(model => model.CONTRACT.USER_CREATE, "User Create", htmlAttributes: new { @class = "control-label" })
                        @Html.EditorFor(model => model.CONTRACT.USER_CREATE, new { htmlAttributes = new { @class = "form-control", @Value = (string)ViewBag.User_create } })
                        @Html.ValidationMessageFor(model => model.CONTRACT.USER_CREATE, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        @Html.LabelFor(model => model.CONTRACT.NOTE, "Contract File", htmlAttributes: new { @class = "control-label" }) :
                        @Html.TextBox("attachment", null, new { @class = "btn btn-primary form-control", @type = "file", @id = "image" })
                        @Html.ValidationMessageFor(model => model.CONTRACT.NOTE, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4"></div>
                    <div class="col-sm-4"></div>
                </div>
            </div>
            <hr />
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <table class="table table-bordered table-hover" id="tab_logic">
                            <thead>
                                <tr>
                                    <th class="text-center">
                                        #
                                    </th>
                                    <th class="text-center">
                                        DATE
                                    </th>
                                    <th class="text-center">
                                        SUB NAME
                                    </th>
                                    <th class="text-center">
                                        CONTENT
                                    </th>
                                    <th class="text-center">
                                        PERIOD
                                    </th>
                                    <th class="text-center">
                                        FILE NAME
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="addr0">
                                    <td>
                                        1
                                    </td>
                                    <td>
                                        <input id="CONTRACT_SUB_0_DATE" type="date" name="CONTRACT_SUB[0].DATE" placeholder="Datum" class="form-control">
                                    </td>
                                    <td>
                                        <input id="CONTRACT_SUB_0_SUBNAME" type="text" name="CONTRACT_SUB[0].SUBNAME" placeholder="SUBNAME" class="form-control">
                                    </td>
                                    <td>
                                        <!--input id="CONTRACT_SUB_0_CONTENT" type="text" name="CONTRACT_SUB[0].CONTENT" placeholder="LOADFILE" class="form-control"-->
                                        <input type="file" name="subcontent" />
                                    </td>
                                    <td>
                                        @Html.DropDownList("PERIOD_ID")
                                        @Html.ValidationMessageFor(model => model.CONTRACT_SUB.PERIODID)
                                    </td>
                                    <td>
                                        <input id="CONTRACT_SUB_0_NOTE" type="text" name="CONTRACT_SUB[0].NOTE" placeholder="NOTE" class="form-control" readonly="readonly">
                                    </td>
                                    <td>
                                        <button class="toggle3">
                                            @Ajax.ActionLink(
                                                                  "Delete",
                                                                  "Delete_contractSUB",
                                                                  "CONTRACT",
                                                                  new { v_id = Model.CONTRACT_SUB.ID, v_contract_id = Model.CONTRACT_SUB.CONTRACTID },
                                                                  new AjaxOptions
                                                                       {
                                                                      UpdateTargetId = "",
                                                                      InsertionMode = InsertionMode.Replace,
                                                              },
                                                              new { @class = "button" }
                                                              )
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--a id='delete_row' class="pull-right btn btn-default">Delete Row</a-->
            </div>
            <div style="text-align:left">
                <input type="button" class="button" value="Cancel" onclick="location.href='@Url.Action("ContractIndex", "CONTRACT")'" />

                <input type="button" id="add_row" class="button" / value="Add">

                <input type="submit" value="Save" />
            </div>
            <hr />
            <div class="row">
                <div class="col-sm-10">
                    <input type="submit" value="Create" class="btn btn-primary" />
                </div>
                <div class="col-sm-2">
                    @Html.ActionLink("Back to List", "Index", null, new { @class = "btn btn-default", @style = "float: right" })
                </div>
            </div>
        }

    </div>
</div>
@section Script {
    <script type="text/javascript">
        $('select').selectron({
            search: true
        });

        $("#contractDate").datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true,
            todayHighlight: true
        });

        $("#dateCreate").datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true,
            todayHighlight: true
        });

        $('#contractDate').on('changeDate', function () {
            var d = new Date($('#contractDate').datepicker('getDate'));
            if (d.getFullYear() > 2000) {
                $('#contractDate_val').val(
                    moment(d).format()
                );
            }
        });

        $('#dateCreate').on('changeDate', function () {
            var d = new Date($('#dateCreate').datepicker('getDate'));
            if (d.getFullYear() > 2000) {
                $('#dateCreate_val').val(
                    moment(d).format()
                );
            }
        });

        $('#contractDate').datepicker('setDate', 'today');
        $('#dateCreate').datepicker('setDate', 'today');

        $(document).ready(function () {
            $("#tab_logic").find('input').click(function () {
                var t = $(this);
                console.log(t);
            });

            var i = 0;
            $("#add_row").click(function () {
                $('#addr' + i).html("<td>" + (i + 1) + "</td>"//<td><input id='date" + i + "'  name='date" + i + "' type='date' placeholder='Datum' class='form-control input-md'  /> </td><td><input id='privatKM" + i + "' name='privatKM" + i + "' type='number' placeholder='Private KM'  class='form-control input-md'></td><td><input id='beruflichKM" + i + "' name='beruflichKM" + i + "' type='number' placeholder='Beruflich KM'  class='form-control input-md'></td><td><input id='reisekosten" + i + "' name='reisekosten" + i + "' type='number' placeholder='Erstattete Reisekosten' class='form-control input-md'  /> </td>");
                    + "<td><input id='CONTRACT_SUB_" + i + "_DATE' name='CONTRACT_SUB[" + i + "].DATE' type='date'></td>"
                    + "<td><input  id='CONTRACT_SUB_" + i + "_SUBNAME' name='CONTRACT_SUB[" + i + "].SUBNAME' type='text' placeholder='SUBNAME'  class='form-control'></td>"
                    //+ "<td><input     id='CONTRACT_SUB_" + i + "_CONTENT' name='CONTRACT_SUB[" + i + "].CONTENT'  type='text' placeholder='LOADFILE'  class='form-control'></td>"
                    + "<td><input type='file' name='subcontent' class='form-control'/></td>"
                    + "<td>" +
                    "<select id='PERIOD_ID' name='PERIOD_ID'>" +
                    "<option selected='selected' value='000001'>Hợp đồng một năm</option>" +
                    "<option value='000002'>Hợp đồng sáu tháng</option>" +
                    "<option value='000003'>Hợp đồng</option>" +
                    "</select>"
                    + "</td>"
                    + "<td><input     id='CONTRACT_SUB_" + i + "_Note' name='CONTRACT_SUB[" + i + "].Note'  type='text' placeholder='NOTE'  class='form-control' readonly='readonl'y></td>"
                );

                $('#tab_logic').append('<tr id="addr' + (i + 1) + '"></tr>');
                i++;
            });
            $("#delete_row").click(function () {
                if (i > 1) {
                    $("#addr" + (i - 1)).html('');
                    i--;
                }
            });

        });
    </script>
}